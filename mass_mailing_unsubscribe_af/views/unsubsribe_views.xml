<?xml version="1.0" encoding="utf-8" ?>
<odoo>

    <template inherit_id="mass_mailing.unsubscribed" id="af_nyhetsbrev_unsubscribed">
        <xpath expr="//div[@id='subscription_info']" position="replace">
            <div id="subscription_info" class="text-center" role="status">
                <p>You have been successfully <strong>unsubscribed</strong>!
                </p>
            </div>
        </xpath>
    </template>

    <template inherit_id="mass_mailing.unsubscribe" id="af_nyhetsbrev_unsubscribe">
        <xpath expr="//h1" position="replace">
            <br/>
            <h1 class="o_page_header" style="color:#00005a;">Mailing Subscriptions</h1>
        </xpath>
        <xpath expr="//form/div/t/p" position="replace">
            <p style="color:#00005a;">Choose your mailing subscriptions</p>
        </xpath>
        <xpath expr="//div[@id='div_opt_out']/div" position="replace">
            <div class="mb64 pt-3">
                <div t-if="show_blacklist_button">
                    <div class="btn pull-right" id="button_add_blacklist"
                         style="display:none;border-color:#00005a;color:#00005a;font-size:17px;border-radius:6px;background-color:#ffffff;">
                        Blacklist Me
                    </div>
                </div>
                <div class="btn pull-right" id="button_remove_blacklist"
                     style="display:none;border-color:#00005a;color:#00005a;font-size:17px;border-radius:6px;background-color:#ffffff;">
                    Come Back
                </div>
                <button type="submit" id="send_form" class="btn"
                        style="border-color:#00005a;color:#00005a;font-size:17px;border-radius:6px;background-color:#ffffff;">
                    Update my subscriptions
                </button>
            </div>
        </xpath>
        <xpath expr="//ul[@class='list-group']/t/t/li/t" position="replace">
            <t style="color:#00005a" t-esc="list_id.name"/>
        </xpath>
        <xpath expr="//div[@id='info_state']" position="attributes">
            <attribute name="class">text-center</attribute>
            <attribute name="style">color:#00005a;font-size:17px;</attribute>
        </xpath>
    </template>

    <template inherit_id="mass_mailing_custom_unsubscribe.reason" id="af_nyhetsbrev_unsubscribe_reason">
        <xpath expr="//div[@id='custom_div_feedback']" position="replace"/>
    </template>


    <record model="mail.unsubscription.reason" id="mass_mailing_custom_unsubscribe.reason_not_interested">

    </record>

    <template inherit_id="mass_mailing_custom_unsubscribe.reason_form" id="af_nyhetsbrev_unsubscribe_reason_form">
        <xpath expr="//form" position="attributes">
            <attribute name="role">form</attribute>
            <attribute name="aria-labelledby">legend</attribute>
        </xpath>
        <xpath expr="//form" position="inside">
            <h2 style="font-size:22px; font-family:Open Sans-Semibold; color:#333333; font-weight:600;">Hjälp oss bli bättre!</h2>
            <p style="font-size: 16px; font-family: Open Sans; color: #333333;">Hjälp oss erbjuda relevant och intressant information genom att berätta varför du vill avsluta din prenumeration</p>
            <fieldset style="margin-top:18px;">
                <legend id="legend" style="font-family: Open Sans-Semibold; font-weight:600; color:#333333; font-size: 16px; margin-bottom: 12px;">
                    Varför vill du avsluta din prenumeration? (frivilligt)
                </legend>
                <div class="col-md-12 mb16">
                    <t t-foreach="reasons" t-as="reason">
                        <div t-if="reason_index == 0" class="radio" style="color:#00005a; display:none;">
                            <label>
                                <input type="radio" name="reason_id" class="opt" t-att-data-details-required="reason.details_required"
                                       t-att-value="reason.id"/>
                                <t t-esc="reason.display_name"/>
                            </label>
                        </div>
                        <div t-else="" class="radio" style="color:#00005a">
                            <label>
                                <input type="radio" name="reason_id" class="opt" t-att-data-details-required="reason.details_required"
                                       t-att-value="reason.id"/>
                                <t t-esc="reason.display_name"/>
                            </label>
                        </div>
                    </t>
                </div>
                <div id="other_reason">
                    <label style="color:#00005a;" for="other_reason_textfield">Beskriv annan orsak</label>
                    <textarea id="other_reason_textfield" class="form-control" name="details" style="max-width:600px; height:75px;"></textarea>
                </div>
                <div class="form-group mb16 mt16">
                    <button id ="unsubscribe" type="submit" style="background: #00005a; border-radius: 6px;" class="button" onclick="return openDialog(event)">
                        <b>Unsubscribe now</b>
                    </button>
                </div>
            </fieldset>
        </xpath>
        <xpath expr="//form/div" position="replace"/>
    </template>

    <template id="web_layout_title_custom" name="change title" inherit_id="web.layout">
        <xpath expr="//title" position="replace">
            <title>Arbetsförmedlingen - Avanmälan</title>
        </xpath>
    </template>

    <template id="mass_mailing.layout" name="Mass Mailing Layout">
        <t t-call="web.layout">
            <t t-set="head">
                <t t-call-assets="web.assets_common"/>
                <t t-call-assets="mass_mailing.assets_backend"/>
            </t>
            <body class="o_white_body">
                <header role="banner">
                    <div class="">
                        <br/>
                        <br/>
                        <img id="af_logo" src="/mass_mailing_unsubscribe_af/static/img/login_logo.jpg"
                             alt="Arbetsförmedlingen logotyp"/>
                    </div>
                </header>
                <main role="main">
                    <t t-raw="0"/>
                </main>
                <div id="dialog" aria-labelledby="dialogName" role="dialog" hidden="" >
                    <div id="closeDiv" onclick="closeDialog('unsubscribe')" aria-label="Close dialog" tabindex="0">
                        <span>Stäng</span>
                        <img src = "/mass_mailing_unsubscribe_af/static/img/IkonerComunication_Cross.svg" alt=""/>
                    </div>
                    <div role="document" id="container">
                        <h2 id="dialogName">Är du säker på att du vill avsluta din prenumeration?</h2>
                        <div id="elementDetail" tabindex="0" role="region" aria-labelledby="dialogName">
                            <p>
                                Du kommer inte längre ta emot informationsbrev från Arbetsförmedlingen. Är du säker på att du vill avsluta prenumerationen?
                            </p>
                            <div id="button_container">
                                <button type="button" id="dialogClose">Nej, gå tillbaka till formuläret</button>
                                <button type="button" id="dialogSubmit">Ja, avsluta prenumerationen</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="overlay"></div>
            </body>
        </t>
    </template>

    <template id="web_layout_custom" inherit_id="web.layout">
        <xpath expr="//meta[@http-equiv='X-UA-Compatible']" position="attributes">
            <attribute name="content">IE=edge</attribute>
        </xpath>
        <xpath expr="//html" position="attributes">
            <attribute name="lang">sv</attribute>
        </xpath>
    </template>

    <record model="ir.ui.menu" id="mass_mailing_custom_unsubscribe.mail_unsubscription_menu">
        <field name="name">(Av)anmälningar</field>
    </record>

    <record model="ir.ui.menu" id="mass_mailing_custom_unsubscribe.mail_unsubscription_reason_menu">
        <field name="name">Skäl till avanmälan</field>
    </record>

    <record model="ir.ui.view" id="mail_unsubscription_inherited_tree">
        <field name="name">mail.unsubscription.inherited_remove_unsubscriber_id_tree</field>
        <field name="model">mail.unsubscription</field>
        <field name="inherit_id" ref="mass_mailing_custom_unsubscribe.mail_unsubscription_view_tree"/>
        <field name="arch" type="xml">
            <field name="unsubscriber_id" position="replace">
                <field name="customer_id"/>
            </field>
        </field>
    </record>

    <record model="ir.ui.view" id="mail_unsubscription_inherited_search">
        <field name="name">mail.unsubscription.inherited_remove_unsubscriber_id_search</field>
        <field name="model">mail.unsubscription</field>
        <field name="inherit_id" ref="mass_mailing_custom_unsubscribe.mail_unsubscription_view_search"/>
        <field name="arch" type="xml">
            <field name="unsubscriber_id" position="replace">
                <field name="customer_id"/>
            </field>
        </field>
    </record>

    <record model="ir.ui.view" id="inherit_mail_unsubscription_view_tree">
        <field name="name">inherit.Mail Unsubscription Tree</field>
        <field name="model">mail.unsubscription</field>
        <field name="inherit_id" ref="mass_mailing_custom_unsubscribe.mail_unsubscription_view_tree"/>
        <field name="arch" type="xml">
            <field name="mass_mailing_id" position="replace">
                <field name="mass_mailing_internal_name"/>
            </field>
        </field>
    </record>

    <record model="ir.ui.view" id="inherit_mail_unsubscription_view_form">
        <field name="name">inherit.Mail Unsubscription Form</field>
        <field name="model">mail.unsubscription</field>
        <field name="inherit_id" ref="mass_mailing_custom_unsubscribe.mail_unsubscription_view_form"/>
        <field name="arch" type="xml">
            <field name="mass_mailing_id" position="replace">
                <field name="mass_mailing_internal_name"/>
            </field>
        </field>
    </record>

    <record model="ir.ui.view" id="inherit_mail_mass_mailing_kanban_af_statistics_unsubscription">
        <field name="name">inherit.mail.mass.mailing.kanban.af.statistics.unsubscription</field>
        <field name="model">mail.mass_mailing</field>
        <field name="inherit_id" ref="mass_mailing.view_mail_mass_mailing_kanban"/>
        <field name="arch" type="xml">
            <xpath expr="//div[hasclass('o_kanban_record_body')]/t/div[4]" position="replace">
                <div class="row">
                    <div class="col-6">
                        <a name="%(mass_mailing.action_view_mass_mailing_links_statistics)d"
                           type="action">Unsubscription Rate
                        </a>
                    </div>
                    <div class="col-6 text-right">
                        <field name="unsubscription_ratio_percent" widget="percentpie"/>
                    </div>
                </div>
            </xpath>
        </field>
    </record>

    <record model="ir.ui.view" id="view_mail_mass_mailing_contact_tree_inherit">
        <field name="name">mail.mass_mailing.contact.tree</field>
        <field name="model">mail.mass_mailing.contact</field>
        <field name="inherit_id" ref="mass_mailing.view_mail_mass_mailing_contact_tree"/>
        <field name="arch" type="xml">
            <field name="opt_out" position="after">
                <field name="opt_out_reason"/>
            </field>
        </field>
    </record>

    <record model="ir.ui.view" id="view_mail_mass_mailing_contact_form_inherit">
        <field name="name">mail.mass_mailing.contact.form</field>
        <field name="model">mail.mass_mailing.contact</field>
        <field name="inherit_id" ref="mass_mailing.view_mail_mass_mailing_contact_form"/>
        <field name="arch" type="xml">
            <field name="opt_out" position="after">
                <field name="opt_out_reason"/>
            </field>
        </field>
    </record>
</odoo>
